<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Flood event separation based on variance — eventsep • FloodR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Flood event separation based on variance — eventsep"><meta property="og:description" content="Based on daily mean discharges, a window-variance is calculated. If this
variance exceeds a certain threshold, a flood event has been detected. To
determine the begin of the flood event, the lag 1 differences are
considered. The point, where the differences are positive for the last time
before the variance exceeds the threshold, is defined as the starting point
(including natural variability). The end of the flood event is defined as
the point where the sum of the rising limb of the event equals approximately
the sum of the falling limb."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FloodR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/flood_division.html">flood events division</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Flood event separation based on variance</h1>
    
    <div class="hidden name"><code>eventsep.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Based on daily mean discharges, a window-variance is calculated. If this
variance exceeds a certain threshold, a flood event has been detected. To
determine the begin of the flood event, the lag 1 differences are
considered. The point, where the differences are positive for the last time
before the variance exceeds the threshold, is defined as the starting point
(including natural variability). The end of the flood event is defined as
the point where the sum of the rising limb of the event equals approximately
the sum of the falling limb.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eventsep</span><span class="op">(</span></span>
<span>  <span class="va">dailyMQ</span>,</span>
<span>  monthlyHQ <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dvar <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  theta <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  ddur <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  omega <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  Kappa <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  eta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  usemed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  medbf <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  NA_mode <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Messages <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dailyMQ</dt>
<dd><p>A dataframe where the date is given as R-date or string
(d.m.Y)) in the first and the daily mean discharges are given in the second
column.</p></dd>


<dt>monthlyHQ</dt>
<dd><p>A dataframe where the date is given as R-date or string
(d.m.Y) in the first and the monthly maximum discharge peaks are given in
the second column.</p></dd>


<dt>dvar</dt>
<dd><p>integer: The window length of the moving variance in days. By
default, it is set to three days.</p></dd>


<dt>gamma</dt>
<dd><p>numeric: Parameter for finding the start.</p></dd>


<dt>theta</dt>
<dd><p>numeric: The proportion of the sample variance of the
dvar-day-window variance on the threshold. By default it is set to
theta=0.25.</p></dd>


<dt>ddur</dt>
<dd><p>integer: The approximate minimum length of an overlaid event in
days. By default it is set to ddur=40.</p></dd>


<dt>omega</dt>
<dd><p>integer: Threshold parameter for defining the end of a flood
event. By default it is set to omega=2.</p></dd>


<dt>Kappa</dt>
<dd><p>numeric: Threshold parameter for defining the begin of a flood
event. By default it is set to Kappa=0.4.</p></dd>


<dt>eta</dt>
<dd><p>numeric: Threshold parameter for defining the begin of a flood
event. By default it is set to eta=0.1.</p></dd>


<dt>delta</dt>
<dd><p>numeric: Threshold parameter for defining the end of a flood
event. By default it is set to delta=0.2.</p></dd>


<dt>usemed</dt>
<dd><p>logical: Should the median of relative difference between the
baseflow at the end and the begin be considered to determine the end of the
flood event.</p></dd>


<dt>medbf</dt>
<dd><p>numeric: The median of relative difference between the baseflow
at the end and the begin of all separated flood events. Used to define the
end of the event, if usemed=TRUE.</p></dd>


<dt>NA_mode</dt>
<dd><p>integer: If the timeseries does contain any NA values,
NA_mode can be used to interpolate all gaps of continious NA-values by
linear interpolation. Only gaps smaller or equal to NA_mode (&gt;=0) will be
interpolated.  Additionally, if the timeseries contains larger gaps, the
timeseries is splited into subsamples with each being seperated intependend.
The resulting separation table will still be append together.</p></dd>


<dt>Messages</dt>
<dd><p>logical: Should messages be thrown out</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A dataframe is returned with the following columns, where each row
is a flood event:</p>
<dl><dt>Begin</dt>
<dd><p>date (d.m.Y) of the begin of the flood event</p></dd>
 <dt>End</dt>
<dd><p>date
(d.m.Y) of the end of the flood event</p></dd>
 <dt>Peak_date</dt>
<dd><p>date (d.m.Y) of the
maximum daily discharge during the flood event</p></dd>
 <dt>DailyMQ</dt>
<dd><p>maximum daily
mean discharge [m³/s] during the flood event</p></dd>
 <dt>Volume</dt>
<dd><p>volume [Mio.
m³] of the flood event calculated by the sum of all daily mean discharges
during the flood event</p></dd>
 <dt>dir_Volume</dt>
<dd><p>direct volume [Mio. m³]
calculated by the difference of the volume and the baseflow. The baseflow is
estimated by a straight line between the discharge at the beginning and the
end of the flood event.</p></dd>
 <dt>baseflow_peak</dt>
<dd><p>baseflow [m³/s] at the day of
the flood peak, calculated by the straight-line method.</p></dd>

<dt>baseflow_begin</dt>
<dd><p>baseflow [m³/s] at the beginning of the flood event,
equal to the daily mean discharge of the beginning of the flood event.</p></dd>

<dt>baseflow_end</dt>
<dd><p>baseflow [m³/s] at the end of the flood event, equal to
the daily mean discharge of the end of the flood event.</p></dd>

<dt>No_peaks</dt>
<dd><p>number of peaks during the flood event</p></dd>
 <dt>HQ</dt>
<dd><p>peak
discharge [m³/s] of the flood event taken from the monthly maximum
discharges. If no monthly maximum discharge is available for the flood
event, it is set to NA.</p></dd>
 <dt>HQ_dir</dt>
<dd><p>direct peak discharge, claculated by
the difference of HQ and baseflow_peak</p></dd>
 <dt>comments</dt>
<dd><p>a short note if the
event is overlaid, or first respectively second part of a double-peaked
flood event.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>To characterize the flood regime, it is necessary to estimate single events
and to separate the amount of direct runoff from the total volume. For this
purposes, a procedure is developed, which is based on the following three
assumptions:</p>
<p>• A flood event is an exceedance of the normal discharge within a time
span. For every flood event beginning and end has to be specified.</p>
<p>• A flood event is characterized by significantly increased discharge
dynamics. Especially around the flood peaks, the sample variance of daily
discharges within a moving time window will be higher than for other time
periods with the same length.</p>
<p>• For all flood events, the volume of the rising limb of the hydrograph
has to be equal the volume of the falling limb.</p>
<p>An assumed increase of base flow during the event has to be considered. The
automatic event separation is based on the Lag one (1 day) differences of
the daily mean discharges \(QD_i= Q_i-Q_{i-1}\) , with \(QD_1=0\), and
the sample variance of daily discharges within a moving window of dvar days:
$$Var_{d_{var}}(i)=Var(Q_{i-(d_{var}-1)},\ldots,Q_i)$$
$$Var_{d_{var}}(j)=0, for j=1,…,dvar.$$ The appropriated window length
depends on the reaction time of the watershed and in this way from the
catchment size. In our studies we modified it between 3 and 7 days, but 3
days were appropriated for nearly all catchments.  To indicate the time span
of the flood event, the sample variance has to exceed a certain threshold.
We defined this threshold with the mean plus \(0.25 \sigma\) variance of
all sample variances which could be derived within the long discharge
series: $$T{{H}_{var}}=\overline{{{V}_{{{d}_{var}}}}}+0.25\cdot
\sqrt{Var({{V}_{{{d}_{var}}}})}.$$ The peak is located within the time span,
where the sample variance exceeds this threshold.  The starting point of the
flood event was defined as the time step in front of the peak for which the
lag one-difference QD is negative for the last time:
$$t_{start}=\max\lbrace 1\leq i &lt; t_{peak} | QD_i &lt;0 \rbrace.$$ From this
point on, discharges increase until the peak is reached.  However, this
increase does not always indicate the true start of the flood event.
Instead, the natural variability in discharge can lead to an increase. To
consider this, a temporal decrease between two discharges in succession of
10 percent was accepted. In such cases, the starting point was shifted
further in the future (\(Q_{t_{start}}= Q_{t_{start}+1}\)) until the
following condition was fulfilled:
$$|({{Q}_{{{t}_{s}}_{tart}}}-{{Q}_{{{t}_{start}}+1}})/{{Q}_{{{t}_{start}}+1}}|&lt;0.1.$$
The rising limb of a flood event is not steady, often pre-floods occured. We
handled this by setting \(t_{start}=t_{start}-2\), if
\((Q_{t_{start}-1}-Q_{t_{start}-2})&gt; 0.4 (Q_{t_{peak}}-Q_{t_{start}})\).
This condition ensures that the rising limb is included in total in the
flood event. For the case where the rising limb of the two days before the
peak has been larger than \(40\%\) of the actual limb we included these
days in the flood event since they define a pre-flood. To define the end of
the flood event we needed to find the time for which the differences between
the volumes of the rising limb (SI) and the falling limb is approximately
zero. Since also a possible increase of the baseflow during the flood event
has to be considered, we define the end by $${{t}_{end}}= \min \left\{
{{t}_{peak}}+1\le t\le n|\left( {{\beta }_{B;k}}\le median({{\beta }_{B}})
\right)\vee \left( \left( \sum\limits_{i={{t}_{peak}}+1}^{t}{Q}{{D}_{i}}\le
{{Q}_{{{t}_{start}}}} \right)\wedge \\ \left( 0.2\left(
SI-\sum\limits_{i={{t}_{peak}}+1}^{t}{Q}{{D}_{i}} \right)\ge
(Q{{D}_{t+1}}+Q{{D}_{t+2}}) \right) \right) \right\}, $$ where
\(\beta_{B;k}\) is the slope of the baseflow of the event. This includes
two criteria: the volume of the falling limb is smaller than the baseflow at
the beginning of the flood and the following two days the difference between
the volume of the rising limb and the falling limb is not reduced by more
than \(20\%\). Alternatively, also the slope of the baseflow between start
and end of the hydrograph is smaller than the median of the slope of the
baseflow for all other flood events of the considered gauge. The number of
peaks of the flood event then can be estimated by the number of time periods
of exceedance of the variance threshold.</p>
<p>A special case that cannot be addresses directly by the procedure described
above are flood events with multiple peaks. Here, we want to divide into two
main cases: the superposition of two flood events and superimposed floods.
In the first case, a second flood event begins before the recession of the
first event has ended. This leads to an enhancement of the second event. The
second case corresponds to a time period of an already increased baseflow,
e.g. due to snowmelt. If flood events occur during this period, they are
superimposed on this increased baseflow. Of course, not every flood event
with multiple peaks belong to either of this cases. We define that a flood
event consists potentially of superpositioned events of the originally
separated event has a duration of less than 40 days. This parameter can be
chosen according to the catchment size. Since the Mulde basin only consist
of mesoscale catchments, this threshold is sufficient for our purpose. We
then apply the independence criterion by Klein (2009) to validate if there
are independent peaks within this event, i.e. two peaks - That deviate by
less than five times the smaller peak - For which the larger peak is more
than 2.5 times as large as the smallest discharge between both peaks - For
which \(70\%\) of the smaller peak are larger than the smalles discharge
between two peaks.</p>
<p>This criterion ensures that both peak are large enough to be separate flood
event and that the recession of the first event is large enough to state
them as independent. For all peaks that fulfill this criterion we choose the
two peaks with the largest recession in between. According to this, two
sub-events are defined, the first one with starting point equal to the
original event begin. The end of this event is estimated by the lowest
discharge between both peaks to which the recession of the original event is
added (that are all discharge values smaller than the values of the valley)
to reconstruct the overlaid recession of the first event. The second events
begins with the smallest discharge value between both peaks and end with the
original ending. Superimposed events can occur if the originally separated
event has a duration larger than 40 days. Again, all peaks are checked for
independence and are separated again. Since the separation of multiple peak
events, especially of superimposed events is rather difficult, a manual
check afterwards is recommended.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Important note: If a double-peaked or an overlaid event occurs, the
whole event is listed in the output first, followed by the splitted partial
events.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Klein, B. (2009): Ermittlung von Ganglinien für die
risikoorientierte Hochwasserbemessung von Talsperren. Schriftenreihe des
Lehrstuhls Hydrologie, Wasserwirtschaft und Umwelttechnik, Ruhr-University
Bochum.</p>
<p>Fischer, S., Schumann, A., &amp; Bühler, P. (2019):
Timescale-based flood typing to estimate temporal changes in flood frequencies.
 Hydrological Sciences Journal, 64(15), 1867–1892. https://doi.org/10.1080/02626667.2019.1679376</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Svenja Fischer</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dailyMQ</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"01.01.2000"</span>, format<span class="op">=</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"01.01.2004"</span>, format<span class="op">=</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>discharge<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">1462</span>,<span class="fl">2</span>,<span class="fl">20</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">monthlyHQ</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"01.01.2000"</span>, format<span class="op">=</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"01.01.2004"</span>, format<span class="op">=</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"months"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>discharge<span class="op">=</span><span class="va">dailyMQ</span><span class="op">$</span><span class="va">discharge</span><span class="op">[</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span><span class="op">*</span><span class="fl">12</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">49</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eventsep</span><span class="op">(</span><span class="va">dailyMQ</span>, <span class="va">monthlyHQ</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philipp Buehler, Svenja Fischer, Laura Haendel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

